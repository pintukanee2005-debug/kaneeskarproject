<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>H2Oclear-X | Revolutionizing Microplastic Detection</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
</head>

<body>
  <header class="header">
    <nav class="nav container">
      <div class="nav-brand">
        <span class="logo">H<span class="logo-accent">2O</span>clear-x</span>
      </div>
      <ul class="nav-menu" id="navMenu">
        <li><a href="#home" class="nav-link">Home</a></li>
        <li><a href="#features" class="nav-link">Features</a></li>
        <li><a href="#dashboard" class="nav-link" onclick="navigateTo('dashboard')">Dashboard</a></li>
        <li><a href="#contact" class="nav-link">Contact</a></li>
      </ul>
      <button class="btn btn--primary" onclick="navigateTo('login')">Login</button>
      <button class="nav-toggle" id="navToggle">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </nav>
  </header>

  <main>
    <section class="hero" id="home">
      <div class="container">
        <div class="hero-content">
          <h1 class="hero-title">Revolutionizing Microplastic Detection</h1>
          <p class="hero-subtitle">
            Experience unprecedented accuracy with our cutting-edge technology. Detect microplastics down to 10-100 Œºm with minimal sample preparation, powered by battery or solar operation for ultimate portability.
          </p>
          <button class="btn btn--hero" onclick="scrollToSection('technology')">Learn More</button>
        </div>
        <div class="hero-visual">
          <div class="device-mockup">
            <div class="device-screen">
              <div class="bluetooth-indicator active" id="bluetoothStatus">
                <span class="bluetooth-icon">üì∂</span>
                <span>Connected</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="bluetooth-section">
      <div class="container">
        <h2 class="section-title">Effortless Wireless Connectivity</h2>
        <p class="section-subtitle">No cables. No hassle. Just real-time data at your fingertips.</p>
        <div class="bluetooth-demo">
          <div class="device-connection">
            <div class="bluetooth-device">
              <div class="device-status" id="deviceStatus">
                <span class="status-indicator"></span>
                <span>Not Connected</span>
              </div>
            </div>
            <div class="connection-animation">
              <div class="connection-line" id="connectionLine"></div>
              <div class="signal-waves">
                <div class="wave wave-1"></div>
                <div class="wave wave-2"></div>
                <div class="wave wave-3"></div>
              </div>
            </div>
            <div class="mobile-device">
              <div class="phone-screen">
                <div class="app-interface">
                  <div class="data-stream">
                    <div class="data-point"></div>
                    <div class="data-point"></div>
                    <div class="data-point"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <button class="btn btn--secondary" id="connectBtn">Connect Device</button>
        </div>
      </div>
    </section>

    <div id="dashboardPage" class="page-content hidden">
      <div class="dashboard-header">
        <div class="container">
          <div class="dashboard-nav">
            <button class="btn btn--outline" onclick="navigateTo('home')">‚Üê Back to Home</button>
            <h1>Data Dashboard</h1>
            <div class="bluetooth-status">
              <div class="status-indicator active"></div>
              <span>Device Connected</span>
            </div>
          </div>
        </div>
      </div>

      <div class="dashboard-content">
        <div class="container">
          <div class="charts-grid">
            <div class="chart-card">
              <h3>Microplastic Count Over Time</h3>
              <div class="chart-container" style="position: relative; height: 300px;">
                <canvas id="timeSeriesChart"></canvas>
              </div>
            </div>
          </div>

          <div class="table-section">
            <h3>Recent Detections</h3>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Location</th>
                    <th>Date</th>
                    <th>Size (Œºm)</th>
                    <th>Type</th>
                    <th>Count</th>
                  </tr>
                </thead>
                <tbody id="detectionsTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    const SERVICE_UUID = '12345678-1234-1234-1234-123456789abc';
    const CHARACTERISTIC_UUID = 'abcdefab-1234-1234-1234-abcdefabcdef';

    let bleDevice = null;
    let bleCharacteristic = null;

    const statusSpan = document.getElementById("deviceStatus").querySelector("span:last-child");
    const connectBtn = document.getElementById("connectBtn");
    const dashboardStatus = document.querySelector(".dashboard-nav .bluetooth-status span");

    async function connectBluetooth() {
      try {
        statusSpan.textContent = "Scanning...";
        connectBtn.disabled = true;

        bleDevice = await navigator.bluetooth.requestDevice({
          filters: [{ services: [SERVICE_UUID] }]
        });

        const server = await bleDevice.gatt.connect();
        const service = await server.getPrimaryService(SERVICE_UUID);
        bleCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);

        await bleCharacteristic.startNotifications();
        bleCharacteristic.addEventListener('characteristicvaluechanged', handleBLEData);

        statusSpan.textContent = "Connected";
        dashboardStatus.textContent = "Device Connected ‚úÖ";
      } catch (error) {
        statusSpan.textContent = "Connection Failed";
        connectBtn.disabled = false;
      }
    }

    function handleBLEData(event) {
      const value = event.target.value;
      const floatArray = new Float32Array(value.buffer);
      const reading = floatArray[0];

      updateCharts(reading);
      addToTable(reading);
    }

    let timeSeriesChart = null;
    let timeData = [];
    let countData = [];

    function initCharts() {
      const ctx = document.getElementById('timeSeriesChart').getContext('2d');
      timeSeriesChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timeData,
          datasets: [{
            label: 'Microplastic Count',
            data: countData,
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.3
          }]
        },
        options: {
          scales: {
            x: { title: { display: true, text: 'Time' }},
            y: { title: { display: true, text: 'Count' }}
          }
        }
      });
    }

    function updateCharts(reading) {
      const now = new Date().toLocaleTimeString();
      timeData.push(now);
      countData.push(reading);

      if (timeData.length > 10) {
        timeData.shift();
        countData.shift();
      }

      if (timeSeriesChart) timeSeriesChart.update();
    }

    function addToTable(reading) {
      const table = document.getElementById("detectionsTable");
      const row = table.insertRow(0);
      row.innerHTML = `
        <td>Unknown</td>
        <td>${new Date().toLocaleDateString()}</td>
        <td>-- Œºm</td>
        <td>Plastic</td>
        <td>${reading}</td>
      `;
    }

    function navigateTo(sectionId) {
      document.querySelectorAll(".page-content").forEach(p => p.classList.add("hidden"));
      if (sectionId === 'dashboard') {
        document.getElementById("dashboardPage").classList.remove("hidden");
        initCharts();
      } else if
